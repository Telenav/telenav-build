#!/bin/bash

#///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
#
#  Â© 2011-2021 Telenav, Inc.
#  Licensed under Apache License, Version 2.0
#
#///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

# 1. telenav-branch-develop
# 2. [update change-log.md]
# 3. [update kivakit.version]
# 4. telenav-commit && telenav-push
# 5. telenav-clean-sparkling && kivakit-release && mesakit-release
# 6. [check release]
# 7. [commit and push assets repositories]
# 8. [publish release to maven central]
# 9. kivakit-merge-to-releases && mesakit-merge-to-releases
# 10. kivakit-bump-version && mesakit-bump-version

confirm_done()
{
    REPLY="n"
    while [ ! "$REPLY" == "y" ]
    do
        read -r -p "   Done? (y/n) "
    done
}

step()
{
    echo " "
    echo "$1"
    echo " "
}

echo " "
echo "=================================================="
echo "Step-by-Step Release for KivaKit and MesaKit"
echo "=================================================="

step "1. Switch all projects to develop branch"

confirm_done

step "2. Update change-log.md"

confirm_done

step "3. Commit and push changes"

telenav-commit "prepare for release"
telenav-push

step "4. Clean and build the release"

telenav-clean-sparkling
kivakit-release
mesakit-release

step "5. Check the release and add any newly created files"

confirm_done

step "6. Commit and push assets repositories"

telenav-commit "update documentation assets"
telenav-push

step "7. Publish the release to maven central"

confirm_done

step "8. Merging develop branch to releases"

kivakit-merge-to-releases
mesakit-merge-to-releases

step "9. Bumping version numbers"

kivakit-bump-version
mesakit-bump-version
telenav-commit "update to next version"
telenav-push

echo "Done!"
